<font face="microsoft yahei">

## What is ASHX Handler 

Some ASP.NET files are dynamic. They are generated with C# code or disk resources. These files do not require web forms. Instead, an ASHX generic handler is ideal. It can return an image from a query string, write XML, or any other data.

### goal of using ASHX files in ASP.NET framework

We use the ASHX file in a URL, and have it dynamically return content. We will use the query string. The final URLs will look like this.

>http://www.dotnetperls.com/?file=name

## Getting started

### Create a ASHX file

open your ASP.NET web site. Go to the Website menu and click on the first menu item there, "Add New Item..." This will present the Add New Item dialog box.

Select the "Generic Handler" item, and you will get a new file with some code in it called Handler.ashx.

### Autogenerated code

It defines two parts of the IHttpHandler interface. The important part is ProcessRequest(), which will be invoked whenever the Handler.ashx file is requested.

### Mappings

To map an older URL or path to your new ASHX file. For backwards compatibility and for search engine optimization, you will probably want the new handler to take over an old URL in your site.


```xml
<system.web>
    <urlMappings enabled="true">
        <add url="~/Default.aspx" mappedUrl="~/Handler.ashx"/>
</urlMappings>
```

### Add example image

what you can do with the ASHX file involving images. Find your favorite image on your disk or on the Internet and add it to your website project. For my example, the image I chose was "Flower1.png".


### Modify Handler.ashx

Your handler has two parts. Here we modify the ProcessRequest method. We can change the ContentType of the file and the Response content. Modify your Handler.ashx to be similar to the following, with your image ContentType and file name.

```csharp
<%@ WebHandler Language="C#" Class="Handler" %>

using System;
using System.Web;

public class Handler : IHttpHandler {

    public void ProcessRequest (HttpContext context) {
        // Comment out these lines first:
        // context.Response.ContentType = "text/plain";
        // context.Response.Write("Hello World");

        context.Response.ContentType = "image/png";
        context.Response.WriteFile("~/Flower1.png");
    }

    public bool IsReusable {
        get {
            return false;
        }
    }
}
```

### Test handler

Here we test the new configuration and ASHX file on the local machine. Now click the green arrow to run your website on the development server. You should see the image in your browser. This is the result of the handler.

![](https://s1.ax1x.com/2020/10/17/0LXSl8.png)

### Add functionality

The example here so far is relatively useless. All it does is allow us to pipe an image through an ASHX handler. You can add any functionality (logging code or referrer logic) to the handler in the C# language.

Also, developers commonly need to use the QueryString collection on the Request. You can use the Request.QueryString in the Handler just like you would on any ASPX web form page. The code is the same.

```csharp
<%@ WebHandler Language="C#" Class="Handler" %>

using System;
using System.Web;

public class Handler : IHttpHandler {

    public void ProcessRequest (HttpContext context) {

        HttpResponse r = context.Response;
        r.ContentType = "image/png";
        //
        // Write the requested image
        //
        string file = context.Request.QueryString["file"];
        if (file == "logo")
        {
            r.WriteFile("Logo1.png");
        }
        else
        {
            r.WriteFile("Flower1.png");
        }
    }

    public bool IsReusable {
        get {
            return false;
        }
    }
}
```

The above code receives requests and then returns a different file based on the QueryString collection value. It will return one of two images from the two query strings. The strings it returns are shown.

- URL 1
    - URL: http://www.dotnetperls.com/?file=logo
    - File query string: logo
    - File written: Logo1.png

- URL 2

    - URL: http://www.dotnetperls.com/?file=flower
    - File query string: flower
    - File written: Flower1.png

### Performance

Is there any performance advantage or change to using ASHX files? These files are less complex and they do not involve as many events. They are more streamlined and involve less code, and this is an advantage.

## Summary

We used ASHX custom handlers in an ASP.NET website. This could fill many different important web site functions. We combine urlMappings with query strings on custom handlers to greatly simplify and streamline back-end web site code.

## Reference

https://www.dotnetperls.com/ashx